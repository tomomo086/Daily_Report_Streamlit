# 日報アプリ - プライバシー保護実装

## 概要

このドキュメントは、日報作成ツールに実装されたプライバシー保護機能について説明します。履歴に残らないファイル処理を実現するための各種対策を詳しく説明しています。

## 実装された機能

### 1. プライバシー保護ファイル処理 (`utils/privacy_utils.py`)

#### `PrivacyFileHandler` クラス
- **一時ファイルの安全な作成・削除**
  - システムの一時ディレクトリに制限されたパーミッション（700）で作成
  - ファイル処理後は自動的に安全削除（3回のランダムデータ上書き）
  - コンテキストマネージャーとして使用可能

- **ファイル名の匿名化**
  - アップロード・ダウンロード時のファイル名を匿名化
  - タイムスタンプ + ランダムな16進数で構成
  - 元のファイル名は表示されない

- **セキュアな削除処理**
  - ファイル削除前にランダムデータで3回上書き
  - ファイルシステムレベルでの完全削除
  - 復元不可能な状態で削除

#### 主要関数
- `get_anonymous_download_name()`: 匿名化されたダウンロードファイル名を生成
- `clear_browser_cache_headers()`: ブラウザキャッシュ防止ヘッダーを返す

### 2. セキュリティガイダンス (`utils/security_tips.py`)

#### `show_privacy_tips()`
- プライバシー保護のための詳細なガイドを表示
- ブラウザ別の履歴クリア手順
- プライベートブラウジングモードの使用法
- 追加のセキュリティ対策

#### `show_security_warning()`
- 機密情報取り扱い時の重要な警告を表示
- 必須のセキュリティ対策を明示

#### `show_cleanup_instructions()`
- 処理完了後のクリーンアップ手順を表示
- ブラウザとシステムの両方での清掃方法

### 3. メインアプリケーション統合

#### ファイルアップロード処理
- アップロード時のファイル名匿名化
- プライバシー保護の明示的な通知
- ファイルサイズ制限の維持

#### ダウンロード処理
- `PrivacyFileHandler`を使用した安全なファイル処理
- 匿名化されたファイル名でのダウンロード
- キャッシュ防止ヘッダーの設定
- 処理完了後の自動クリーンアップ

## プライバシー保護の仕組み

### 1. サーバーサイド保護
- **一時ファイル処理**: メモリ上での処理を最優先
- **安全削除**: 物理的な上書き削除でファイル復元を防止
- **制限されたパーミッション**: 他のプロセスからアクセス不可

### 2. クライアントサイド保護
- **ファイル名匿名化**: 元のファイル名は表示されない
- **キャッシュ防止**: ブラウザキャッシュにファイルが残らない
- **プライベートブラウジング推奨**: 履歴に残らないブラウジングを推奨

### 3. ユーザーガイダンス
- **操作ガイド**: 各ブラウザでの履歴クリア方法を詳細に説明
- **セキュリティ警告**: 機密情報処理時の注意点を明示
- **クリーンアップ手順**: 処理完了後の推奨手順を提供

## 使用方法

### 1. 基本的な使用法
```python
from utils.privacy_utils import PrivacyFileHandler

# コンテキストマネージャーとして使用
with PrivacyFileHandler() as handler:
    # ファイル処理
    temp_file = handler.create_temp_file(file_content)
    # 処理完了後は自動的にクリーンアップ
```

### 2. 匿名化ファイル名の生成
```python
from utils.privacy_utils import get_anonymous_download_name

# 匿名化されたファイル名を生成
anonymous_name = get_anonymous_download_name("original_file.xlsx")
# 結果: "report_20240101_a3f7b2.xlsx"
```

### 3. セキュリティガイドの表示
```python
from utils.security_tips import show_privacy_tips, show_cleanup_instructions

# プライバシーTipsを表示
show_privacy_tips()

# クリーンアップ手順を表示
show_cleanup_instructions()
```

## セキュリティ対策の推奨事項

### 1. ユーザー向け推奨事項
- プライベートブラウジングモードの使用
- 処理後のブラウザ履歴完全削除
- 共有PC での使用回避
- VPN使用による IP アドレス隠蔽

### 2. システム管理者向け推奨事項
- 定期的な一時ファイル清掃
- アクセスログの定期削除
- HTTPS通信の強制
- セキュリティヘッダーの適切な設定

### 3. 開発者向け推奨事項
- 機密データのメモリ上処理
- ログファイルへの機密情報出力回避
- 暗号化通信の使用
- 定期的なセキュリティ監査

## 制限事項

### 1. 技術的制限
- ブラウザの履歴削除はユーザーが手動で実行する必要がある
- ネットワークログは別途対策が必要
- OSレベルのファイル復元ツールによる復元可能性

### 2. 運用上の制限
- ユーザーの協力が必要（履歴削除等）
- 完全な匿名性は保証されない
- 法的要件によっては追加対策が必要

## トラブルシューティング

### 1. 一時ファイル作成エラー
- 一時ディレクトリの権限を確認
- ディスク容量を確認
- プロセスの権限を確認

### 2. ファイル削除エラー
- ファイルがロックされていないか確認
- 他のプロセスによる使用がないか確認
- ファイルシステムの権限を確認

### 3. ブラウザキャッシュ問題
- ブラウザの設定を確認
- プライベートブラウジングモードの使用
- 手動でのキャッシュクリア実行

## まとめ

この実装により、日報作成ツールは以下の点でプライバシー保護を実現しています：

- **サーバーサイド**: 一時ファイルの安全な処理と削除
- **クライアントサイド**: ファイル名の匿名化とキャッシュ防止
- **ユーザーガイダンス**: 適切な使用方法の提供

完全な匿名性を求める場合は、追加のセキュリティ対策（VPN、Tor等）の併用を推奨します。